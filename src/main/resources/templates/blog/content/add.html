<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" th:with="title='b_content'">
<meta charset="utf-8">
<header th:replace="header::header(${title})"></header>
<link th:href="@{/blog/resource/plugins/toggles/toggles.css}" rel="stylesheet" />
<link th:href="@{/blog/resource/plugins/md/css/style.css}" rel="stylesheet" />
<style>
#tags_tagsinput {
	background-color: #fafafa;
	border: 1px solid #eeeeee;
}

#tags_addTag input {
	width: 100%;
}

#tags_addTag {
	margin-top: -5px;
}
</style>
<body class="gray-bg">
	<div class="wrapper wrapper-content ">
		<div class="row">
			<div class="col-md-12">
				<form id="articleForm" role="form" novalidate="novalidate">
					<input type="hidden" name="categories" id="categories" /> <input type="hidden" name="cid" th:value="${content!=null and content.cid!=null}?${content.cid}: ''" id="cid" /> <input
						type="hidden" name="status" th:value="${content!=null and content.status !=null}?${content.status}: 'publish'" id="status" /> <input type="hidden" name="allowComment"
						th:value="${content!=null and content.allowComment !=null}?${content.allowComment}: 1" id="allow_comment" /> <input type="hidden" name="allowFeed"
						th:value="${content!=null and content.allowFeed !=null}?${content.allowFeed}: 1" id="allow_feed" /> <input type="hidden" name="content" id="content-editor" />
					<div class="form-group col-md-6" style="padding: 0 10px 0 0;">
						<input type="text" class="form-control" placeholder="请输入文章标题（必须）" name="title" id=”title“ required="required" aria-required="true"
							th:value="${content!=null and content.title!=null }?${content.title}: ''" />
					</div>
					<div class="form-group col-md-6" style="padding: 0 10px 0 0;">
						<input type="text" class="form-control" placeholder="自定义访问路径，如：my-first-article  默认为文章id" name="slug" th:value="${content!=null and content.slug !=null}?${content.slug}: ''" />
					</div>
					<div class="form-group col-md-6" style="padding: 0 10px 0 0;">
						<input name="tags" id="tags" type="text" class="form-control" placeholder="请填写文章标签" th:value="${content!=null and content.tags !=null}?${content.tags}: ''" />
					</div>
					<div class="form-group col-md-6" style="padding: 0 10px 0 0;">
						<input type="text" class="form-control" placeholder="文章分类" name="categories" id="categories" required="required" aria-required="true"
							th:value="${content!=null and content.categories!=null }?${content.categories}: ''" />
					</div>
					<div class="clearfix"></div>
					<div class="form-group">
						<textarea style="height: 450px" autocomplete="off" id="text" name="text" class="markdown-textarea"
							th:utext="${content!=null and content.content !=null}?${content.content}: ''"></textarea>
					</div>
					<div class="form-group col-md-3 col-sm-4">
						<label class="col-sm-4">开启评论</label>
						<div class="col-sm-8">
							<div th:class="${content!=null and content.allowComment!=null }?'toggle toggle-success allow-'+${content.allowComment}:'toggle toggle-success allow-true'"
								onclick="allow_comment(this);"></div>
						</div>
					</div>
					<div class="form-group col-md-3 col-sm-4">
						<label class="col-sm-4">允许订阅</label>
						<div class="col-sm-8">
							<div th:class="${content!=null and  content.allowFeed !=null}?'toggle toggle-success allow-'+${content.allowFeed}: 'toggle toggle-success allow-true'"
								onclick="allow_feed(this);"></div>
						</div>
					</div>
					<div class="clearfix"></div>
					<div class="text-right">
						<th:block th:if="${null != contents}">
							<a class="btn btn-default waves-effect waves-light" id=“returnList” th:href="@{/blog/content}">返回列表</a>
						</th:block>
						<button type="button" class="btn btn-primary waves-effect waves-light" onclick="save('publish');">保存文章</button>
						<button type="button" class="btn btn-warning waves-effect waves-light" onclick="save('draft');">存为草稿</button>
					</div>
				</form>
			</div>
		</div>
	</div>
	<div th:replace="footer :: footer"></div>
	<script th:src="@{/blog/resource/plugins/md/js/jquery.scrollto.js}"></script>
	<script th:src="@{/blog/resource/plugins/md/js/pagedown.js}"></script>
	<script th:src="@{/blog/resource/plugins/md/js/pagedown-extra.js}"></script>
	<script th:src="@{/blog/resource/plugins/md/js/diff.js}"></script>
	<script th:src="@{/blog/resource/plugins/md/js/md.js}"></script>
	<script th:src="@{//cdn.bootcss.com/jquery-toggles/2.0.4/toggles.min.js}"></script>
	<script th:src="@{/blog/resource/js/article.js}"></script>
	<script type="text/javascript">
		var prefix = ctx + "blog/content";
		function save(sta) {
			//校验文章标题
			var title = $('#title').val();
			var content = $('#text').val();
			if (title == '') {
				toastr.warning("请输入文章标题'");
				return;
			}
			if (content == '') {
				toastr.warningn('请输入文章内容');
				return;
			}
			var status =$('#status').val(); 
			if(status!='' && status=="publish"){
				toastr.warningn('已发布的文章不允许暂存');
				return;
			}
			$('#status').val(sta);
			var data = $('#articleForm').serialize();
			console.info(data);
			YiMo.ajaxPost({
				url : prefix + "/save",
				data : $('#articleForm').serialize(),
			});
		}
	</script>
</body>
</html>
